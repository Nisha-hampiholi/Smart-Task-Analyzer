<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskMaster</title>
    <style>
        /* DARK MODE THEME */
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent: #00e676; /* Neon Green */
            --danger: #ff5252;
            --warning: #ff9800;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: white;
        }

        /* Dark Inputs */
        .input-panel {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 4px;
            border: 1px solid #333;
            margin-bottom: 20px;
        }

        label { display: block; margin-top: 10px; color: var(--accent); font-size: 0.9em;}
        
        input, select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            background: #2c2c2c;
            border: 1px solid #444;
            color: white;
            box-sizing: border-box;
        }

        button.main-btn {
            background: var(--accent);
            color: black;
            font-weight: bold;
            border: none;
            padding: 15px;
            width: 100%;
            margin-top: 15px;
            cursor: pointer;
            text-transform: uppercase;
        }
        button.main-btn:hover { opacity: 0.9; }

        /* Bulk Input Styling */
        .bulk-section {
            margin-top: 15px;
            border-top: 1px dashed #333;
            padding-top: 15px;
            color: var(--text-secondary);
        }
        summary { cursor: pointer; color: var(--accent); font-size: 0.9em; font-weight: bold; }
        
        textarea {
            width: 100%;
            height: 80px;
            margin-top: 10px;
            background: #2c2c2c;
            border: 1px solid #444;
            color: white;
            padding: 10px;
            font-family: monospace;
            box-sizing: border-box;
        }
        
        .bulk-btn {
            background: #444;
            color: white;
            border: none;
            padding: 8px 15px;
            margin-top: 5px;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.8em;
        }
        .bulk-btn:hover { background: #555; }

        /* Filter Buttons */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .filter-btn {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 8px 16px;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 1px;
        }
        .filter-btn:hover {
            background: var(--accent);
            color: black;
        }

        /* Task List with Priority Colors */
        .task-item {
            background: var(--card-bg);
            border-bottom: 1px solid #333;
            padding: 15px;
            margin-bottom: 10px;
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            border-left: 5px solid #333; /* Default border */
        }

        /* COLOR CODING INDICATORS */
        .p-high { border-left-color: var(--danger); }  /* RED */
        .p-med { border-left-color: var(--warning); }  /* ORANGE */
        .p-low { border-left-color: var(--accent); }   /* GREEN */

        .score-badge {
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            text-align: right;
        }

        .meta-info {
            color: var(--text-secondary);
            font-size: 0.85em;
            margin-top: 5px;
        }

        .reason {
            color: #ffb74d; 
            font-style: italic;
            margin-top: 5px;
            font-size: 0.9em;
        }
        .reason::before { content: "► "; }

    </style>
</head>
<body>

<div class="container">
    <h1>TaskMaster</h1>

    <div class="input-panel">
        <label>Task Name</label>
        <input type="text" id="title" placeholder="Enter task...">
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div>
                <label>Due Date</label>
                <input type="date" id="dueDate">
            </div>
            <div>
                <label>Hours Needed</label>
                <input type="number" id="hours">
            </div>
        </div>

        <label>Importance (1-10)</label>
        <input type="number" id="importance" min="1" max="10" value="5">

        <button class="main-btn" onclick="addTask()">+ Add to Queue</button>

        <details class="bulk-section">
            <summary>+ Paste JSON (Bulk Import)</summary>
            <textarea id="jsonInput" placeholder='[{"title": "Task A", "due_date": "2025-12-01", "importance": 8, "estimated_hours": 2}]'></textarea>
            <button class="bulk-btn" onclick="loadJson()">Load Data</button>
        </details>
    </div>

    <div class="filters">
        <button class="filter-btn" onclick="analyzeTasks('smart')">Smart Balance</button>
        <button class="filter-btn" onclick="analyzeTasks('urgent')">Deadline Driven</button>
        <button class="filter-btn" onclick="analyzeTasks('effort')">Fastest Wins</button>
        <button class="filter-btn" onclick="analyzeTasks('impact')">High Impact</button>
    </div>

    <div id="results"></div>
</div>

<script>
    let tasks = [];

    function addTask() {
        const title = document.getElementById('title').value;
        const due = document.getElementById('dueDate').value;
        const hours = document.getElementById('hours').value;
        const imp = document.getElementById('importance').value;

        if (!title || !due) { alert("Missing Data"); return; }

        tasks.push({
            "title": title,
            "due_date": due,
            "estimated_hours": parseInt(hours) || 0,
            "importance": parseInt(imp) || 5,
            "dependencies": ""
        });
        alert("Task Added.");
    }

    function loadJson() {
        const raw = document.getElementById('jsonInput').value;
        try {
            const parsed = JSON.parse(raw);
            if (!Array.isArray(parsed)) throw new Error("JSON must be an array []");
            tasks = tasks.concat(parsed);
            alert(`Imported ${parsed.length} tasks.`);
            document.getElementById('jsonInput').value = '';
        } catch (e) {
            alert("Invalid JSON: " + e.message);
        }
    }

    async function analyzeTasks(strategy) {
        const btn = event.target;
        const originalText = btn.innerText;
        btn.innerText = "[ Scanning... ]";
        
        try {
            const response = await fetch('/api/tasks/analyze/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ tasks: tasks })
            });
            const data = await response.json();
            render(data.tasks, strategy);
        } catch (e) {
            console.error(e);
        } finally {
            btn.innerText = originalText;
        }
    }

    function render(list, strategy) {
        const container = document.getElementById('results');
        container.innerHTML = ''; 

        if (strategy === 'urgent') list.sort((a, b) => new Date(a.due_date) - new Date(b.due_date));
        else if (strategy === 'effort') list.sort((a, b) => a.estimated_hours - b.estimated_hours);
        else if (strategy === 'impact') list.sort((a, b) => b.importance - a.importance);

        list.forEach(task => {
            // VISUAL PRIORITY LOGIC
            let colorClass = 'p-low'; // Default Green
            if (task.priority_score > 150) colorClass = 'p-high'; // Red
            else if (task.priority_score > 80) colorClass = 'p-med'; // Orange

            const html = `
                <div class="task-item ${colorClass}">
                    <div>
                        <div style="font-weight:bold; font-size:1.1em;">${task.title}</div>
                        <div class="meta-info">Due: ${task.due_date} • ${task.estimated_hours}h • Lvl ${task.importance}</div>
                        <div class="reason">${task.explanation}</div>
                    </div>
                    <div class="score-badge">${task.priority_score}</div>
                </div>
            `;
            container.innerHTML += html;
        });
    }
</script>
</body>
</html>